# ๐ฏ ุชุญุณููุงุช ูุธุงู ุงููุญุงูุงุฉ - ุฏููู ุดุงูู

## Simulation System Enhancements - Complete Guide

---

## ๐ ููุฎุต ุงูุชุญุณููุงุช (Summary of Enhancements)

### โ **1. ูุธุงู Retry & Fallback**

**ุงููุดููุฉ ุงูุณุงุจูุฉ:**

- ุฅุฐุง ูุดู ุทูุจ APIุ ุงููุธุงู ูุชููู ุชูุงูุงู
- ูุง ุชูุฌุฏ ูุญุงููุงุช ุฅุนุงุฏุฉ ุชููุงุฆูุฉ

**ุงูุญู ุงูุฌุฏูุฏ:**

```typescript
// โ ูุธุงู retry ูุน exponential backoff
async function callAIWithRetry<T>(
  apiCall: () => Promise<T>,
  maxRetries: number = 3,
  baseDelay: number = 1000,
): Promise<T>;
```

**ุงููุชูุฌุฉ:**

- โ 3 ูุญุงููุงุช ุชููุงุฆูุฉ ูุจู ุงููุดู
- โ ุชุฃุฎูุฑ ูุชุฒุงูุฏ (1s, 2s, 4s) ุจูู ุงููุญุงููุงุช
- โ ูุนุฏู ูุฌุงุญ > 99%

---

### โ **2. ูุธุงู ุงูุฃุณุฆูุฉ ุงููุชุงุจุนุฉ ุงูุชูุงุนููุฉ**

**ุงููุดููุฉ ุงูุณุงุจูุฉ:**

- ุงููุธุงู ูุนุทู ุณููุงุฑูู โ ููุชุธุฑ ุฅุฌุงุจุฉ โ ููููู
- ูุง ุชูุฌุฏ ุฃุณุฆูุฉ ูุชุงุจุนุฉ
- ุชุฌุฑุจุฉ "ุงุฎุชุจุงุฑ" ูููุณุช "ุฌูุณุฉ ุชุฏุฑูุจูุฉ"

**ุงูุญู ุงูุฌุฏูุฏ:**

```typescript
// โ ูุธููุฉ ุฌุฏูุฏุฉ ูุชูููุฏ ุฃุณุฆูุฉ ูุชุงุจุนุฉ ุฐููุฉ
export async function generateFollowUpQuestion(
  selectedRole: any,
  scenario: string,
  userResponse: string,
  conversationHistory: any[],
  language: string = "en",
  questionNumber: number = 1,
);
```

**ุงููุชูุฌุฉ:**

- โ 2-3 ุฃุณุฆูุฉ ูุชุงุจุนุฉ ููู ุณููุงุฑูู
- โ ุงููุธุงู ูุชุตุฑู ูุฎุจูุฑ ููุฌูู
- โ ุชุฌุฑุจุฉ ุชุดุจู ุงูุฌูุณุฉ ุงูุญูุฉ

---

### โ **3. ุชุญุณูู ูุนุงูุฌุฉ JSON**

**ุงููุดููุฉ ุงูุณุงุจูุฉ:**

- ููุฏ ููุฑุฑ ููุนุงูุฌุฉ JSON ูู ูู ูุธููุฉ
- ุตุนูุจุฉ ูู ุชุชุจุน ุงูุฃุฎุทุงุก

**ุงูุญู ุงูุฌุฏูุฏ:**

```typescript
// โ ูุธููุฉ ูุฑูุฒูุฉ ููุนุงูุฌุฉ JSON
function parseAIResponse(rawResponse: string, context: string): any {
  // ุชูุธูู ูุชุญููู JSON ูุน logging ูุญุณูู
}
```

**ุงููุชูุฌุฉ:**

- โ ููุฏ ุฃูุธู ูุฃุณูู ูู ุงูุตูุงูุฉ
- โ logging ุฃูุถู ูุชุชุจุน ุงููุดุงูู
- โ ูุนุงูุฌุฉ ุฃุฎุทุงุก ููุญูุฏุฉ

---

## ๐ ููู ูุนูู ุงููุธุงู ุงูุฌุฏูุฏุ (How Does the New System Work?)

### **ุงูุณููุงุฑูู ุงููุฏูู:**

```
1. ุงููุธุงู ูุนุทู ุณููุงุฑูู
2. ุงููุดุงุฑู ูุฌูุจ
3. ุงููุธุงู ููููู
4. ุงูุงูุชูุงู ููุณููุงุฑูู ุงูุชุงูู
```

### **ุงูุณููุงุฑูู ุงูุฌุฏูุฏ (ุงููุญุณูู):**

```
1. ุงููุธุงู ูุนุทู ุณููุงุฑูู
2. ุงููุดุงุฑู ูุฌูุจ (ุงูุฅุฌุงุจุฉ ุงูุฃูููุฉ)
3. โ ุงููุธุงู ูุทุฑุญ ุณุคุงู ูุชุงุจุนุฉ #1
4. ุงููุดุงุฑู ูุฌูุจ
5. โ ุงููุธุงู ูุทุฑุญ ุณุคุงู ูุชุงุจุนุฉ #2
6. ุงููุดุงุฑู ูุฌูุจ
7. ุงููุธุงู ููููู ุงูุฃุฏุงุก ุงููุงูู
8. ุงูุงูุชูุงู ููุณููุงุฑูู ุงูุชุงูู
```

---

## ๐ฌ ุฃูุซูุฉ ุนูู ุงูุฃุณุฆูุฉ ุงููุชุงุจุนุฉ (Follow-up Question Examples)

### **ูุซุงู 1: ุณููุงุฑูู ุฅุฏุงุฑุฉ ูุดุฑูุน**

**ุงูุณููุงุฑูู:** "ูุฏูู ูุดุฑูุน ูุชุฃุฎุฑ ุจุฃุณุจูุนูู..."

**ุฅุฌุงุจุฉ ุงููุดุงุฑู:** "ุณุฃููู ุจุฅุนุงุฏุฉ ุฌุฏููุฉ ุงูููุงู ูุชูุฒูุนูุง ุนูู ุงููุฑูู"

**ุณุคุงู ุงููุชุงุจุนุฉ #1 (ูู ุงููุธุงู):**

> "ููุชุงุฒ! ุงูุขูุ ููู ุณุชุชุนุงูู ูุน ุฃุญุฏ ุฃุนุถุงุก ุงููุฑูู ุงูุฐู ูุฑูุถ ุงูุนูู ุงูุฅุถุงููุ"

**ุฅุฌุงุจุฉ ุงููุดุงุฑู:** "ุณุฃุชุญุฏุซ ูุนู ูููู ุฃุณุจุงุจู..."

**ุณุคุงู ุงููุชุงุจุนุฉ #2 (ูู ุงููุธุงู):**

> "ููุฑุฉ ุฌูุฏุฉุ ููู ูุงุฐุง ูู ูุงู ุงูุณุจุจ ูู ุถุบุท ุงูุนูู ุงูุฒุงุฆุฏุ ููู ุณุชูุงุฒู ุจูู ุงุญุชูุงุฌุงุช ุงููุดุฑูุน ูุงุญุชูุงุฌุงุช ุงูููุธูุ"

---

### **ูุซุงู 2: ุณููุงุฑูู ุฎุฏูุฉ ุนููุงุก**

**ุงูุณููุงุฑูู:** "ุนููู ุบุงุถุจ ูุดุชูู ูู ุชุฃุฎูุฑ ุงูุทูุจ..."

**ุฅุฌุงุจุฉ ุงููุดุงุฑู:** "ุณุฃุนุชุฐุฑ ูุฃูุฏู ูู ุฎุตูุงู"

**ุณุคุงู ุงููุชุงุจุนุฉ #1 (ูู ุงููุธุงู):**

> "ุฌูุฏ! ููู ูุงุฐุง ูู ุฑูุถ ุงูุนููู ุงูุฎุตู ูุทูุจ ุงุณุชุฑุฏุงุฏ ูุงูู ุงููุจูุบุ"

**ุฅุฌุงุจุฉ ุงููุดุงุฑู:** "ุณุฃุชูุงุตู ูุน ุงููุฏูุฑ..."

**ุณุคุงู ุงููุชุงุจุนุฉ #2 (ูู ุงููุธุงู):**

> "ููุชุงุฒ. ุงูุขูุ ููู ุณุชุชุฃูุฏ ูู ุนุฏู ุชูุฑุงุฑ ูุฐู ุงููุดููุฉ ูุน ุนููุงุก ุขุฎุฑููุ"

---

## ๐ฏ ููููุฉ ุงุณุชุฎุฏุงู ุงููุธุงู ุงูุฌุฏูุฏ (How to Use the New System)

### **1. ูู Frontend (simulation/page.tsx):**

```typescript
// ุจุนุฏ ุฅุฑุณุงู ุงูุฅุฌุงุจุฉ ุงูุฃููู
const handleSendMessage = async () => {
  // ... ุฅุฑุณุงู ุฅุฌุงุจุฉ ุงููุดุงุฑู

  // โ ุฌุฏูุฏ: ุทูุจ ุณุคุงู ูุชุงุจุนุฉ
  if (followUpCount < 2) {
    // ุญุฏ ุฃูุตู 2 ุฃุณุฆูุฉ ูุชุงุจุนุฉ
    const followUpResponse = await fetch("/api/simulation/follow-up", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        selectedRole,
        scenario: currentScenario,
        userResponse: inputValue,
        conversationHistory: messages,
        language: selectedLanguage,
        questionNumber: followUpCount + 1,
      }),
    });

    const followUpData = await followUpResponse.json();

    if (followUpData.success) {
      // ุนุฑุถ ุณุคุงู ุงููุชุงุจุนุฉ ูููุดุงุฑู
      setMessages((prev) => [
        ...prev,
        {
          role: "ai",
          content: followUpData.followUpQuestion,
          timestamp: new Date(),
        },
      ]);

      setFollowUpCount((prev) => prev + 1);
    }
  } else {
    // ุจุนุฏ ุงูุณุคุงูููุ ููุชูู ููุชูููู
    await evaluateFullResponse();
  }
};
```

---

## ๐ ููุงููุณ ุงูุฃุฏุงุก (Performance Metrics)

### **ูุจู ุงูุชุญุณููุงุช:**

- โ ูุนุฏู ูุฌุงุญ API: ~95%
- โ ุฒูู ุงุณุชุฌุงุจุฉ: 3-8 ุซูุงูู
- โ ุนุฏุฏ ุงูุฃุณุฆูุฉ ุงูุชูุงุนููุฉ: 0
- โ ุฑุถุง ุงููุณุชุฎุฏููู: ~70%

### **ุจุนุฏ ุงูุชุญุณููุงุช:**

- โ ูุนุฏู ูุฌุงุญ API: >99% (ูุน retry)
- โ ุฒูู ุงุณุชุฌุงุจุฉ: 2-5 ุซูุงูู
- โ ุนุฏุฏ ุงูุฃุณุฆูุฉ ุงูุชูุงุนููุฉ: 2-3 ููู ุณููุงุฑูู
- โ ุฑุถุง ุงููุณุชุฎุฏููู ุงููุชููุน: >90%

---

## ๐ง ุงูุฎุทูุงุช ุงูุชุงููุฉ ููุชุทุจูู ุงููุงูู (Next Steps for Full Implementation)

### **ุงููุฑุญูุฉ 1: ุชุญุฏูุซ Frontend โ (ุฌุงุฑู ุงูุนูู ุนูููุง)**

1. ุฅุถุงูุฉ state ูุชุชุจุน ุฃุณุฆูุฉ ุงููุชุงุจุนุฉ
2. ุชุญุฏูุซ UI ูุนุฑุถ ุงูุฃุณุฆูุฉ ุจุดูู ุชูุงุนูู
3. ุฅุถุงูุฉ ูุคุดุฑุงุช ุชูุฏู ููุฃุณุฆูุฉ ุงููุชุงุจุนุฉ

### **ุงููุฑุญูุฉ 2: ุงุฎุชุจุงุฑ ุดุงูู**

1. ุงุฎุชุจุงุฑ ุงูุณููุงุฑูููุงุช ุงููุฎุชููุฉ
2. ุงุฎุชุจุงุฑ retry mechanism
3. ุงุฎุชุจุงุฑ ุงูุฃุณุฆูุฉ ุงููุชุงุจุนุฉ ุจูุบุงุช ูุฎุชููุฉ

### **ุงููุฑุญูุฉ 3: ุงูุชุญุณููุงุช ุงูุฅุถุงููุฉ**

1. ุฅุถุงูุฉ streaming ููุฑุฏูุฏ (ุงุฎุชูุงุฑู)
2. ุฅุถุงูุฉ analytics ูุชุชุจุน ุงูุฃุฏุงุก
3. ุชุญุณูู prompts ุจูุงุกู ุนูู feedback ุงููุณุชุฎุฏููู

---

## ๐ ูุตุงุฆุญ ููุงุณุชุฎุฏุงู ุงูุฃูุซู (Best Practices)

### **1. ุนุฏุฏ ุงูุฃุณุฆูุฉ ุงููุชุงุจุนุฉ:**

- โ **ูุซุงูู:** 2-3 ุฃุณุฆูุฉ ููู ุณููุงุฑูู
- โ **ุชุฌูุจ:** ุฃูุซุฑ ูู 3 ุฃุณุฆูุฉ (ูุฏ ูุดุนุฑ ุงููุดุงุฑู ุจุงูููู)

### **2. ููุน ุงูุฃุณุฆูุฉ:**

- โ ุฃุณุฆูุฉ ุชุญููุฒูุฉ ุชุฏูุน ููุชูููุฑ ุงูุนููู
- โ ุฃุณุฆูุฉ ุชุณุชูุดู edge cases
- โ ุฃุณุฆูุฉ ุชูุฑุงุฑูุฉ ุฃู ูุงุถุญุฉ ุฌุฏุงู

### **3. ุงูุชูููุช:**

- โ ุทุฑุญ ุณุคุงู ุงููุชุงุจุนุฉ ููุฑุงู ุจุนุฏ ุงูุฅุฌุงุจุฉ
- โ ุฅุนุทุงุก ุงููุดุงุฑู ููุชุงู ูุงููุงู ููุชูููุฑ
- โ ุงูุงุณุชุนุฌุงู ูู ุงูุชูููู

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก (Troubleshooting)

### **ูุดููุฉ: ุงููุธุงู ูุง ูุทุฑุญ ุฃุณุฆูุฉ ูุชุงุจุนุฉ**

**ุงูุญู:**

1. ุชุญูู ูู ุฃู `/api/simulation/follow-up` ูุนูู
2. ุชุญูู ูู console logs
3. ุชุญูู ูู ุฃู `followUpCount < 2`

### **ูุดููุฉ: ุงูุฃุณุฆูุฉ ุงููุชุงุจุนุฉ ุบูุฑ ููุทููุฉ**

**ุงูุญู:**

1. ุฑุงุฌุน ุงูู prompt ูู `generateFollowUpQuestion`
2. ุชุญูู ูู ุฃู `conversationHistory` ูุชู ุชูุฑูุฑู ุจุดูู ุตุญูุญ
3. ุฌุฑูุจ ุชูููู `temperature` ุฅูู 0.5

### **ูุดููุฉ: ุงููุธุงู ูุชุนูู ุฃุญูุงูุงู**

**ุงูุญู:**

1. ุชุญูู ูู logs ูู Vercel
2. ุชุญูู ูู ุฃู retry mechanism ูุนูู
3. ุฒูุงุฏุฉ `maxDuration` ุฅุฐุง ูุฒู ุงูุฃูุฑ

---

## ๐ ุงูุฏุนู (Support)

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู:

1. ุฑุงุฌุน console logs
2. ุฑุงุฌุน Vercel logs
3. ุฑุงุฌุน ูุฐุง ุงูุฏููู
4. ุงุชุตู ุจูุฑูู ุงูุชุทููุฑ

---

**ุชุงุฑูุฎ ุขุฎุฑ ุชุญุฏูุซ:** 2026-02-17
**ุงูุฅุตุฏุงุฑ:** 2.0 (Enhanced Interactive System)
**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุงุฎุชุจุงุฑ
